<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chatbot con Redirecci√≥n</title>
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
</head>
<body>

 <df-messenger
  intent="WELCOME"
  chat-title="Nina"
  agent-id="820bd1d7-b43e-429d-a741-b1700de65e5a"
  language-code="es"
   chat-icon="https://cdn-icons-png.flaticon.com/512/4712/4712103.png"
   opened="true"
></df-messenger>

 <script>
  window.addEventListener('df-messenger-loaded', () => {
    console.log("‚úÖ df-messenger cargado");

    const dfMessenger = document.querySelector('df-messenger');

    const waitForChat = () => {
      try {
        const chatElement = dfMessenger.shadowRoot.querySelector('df-messenger-chat');
        if (!chatElement) throw "‚è≥ Esperando df-messenger-chat...";

        const chatShadow = chatElement.shadowRoot;
        if (!chatShadow) throw "‚è≥ Esperando shadowRoot interno...";

        const messagesContainer = chatShadow.querySelector('#messageList') ||
                                  chatShadow.querySelector('.message-list') ||
                                  chatShadow.querySelector('.scrollable') ||
                                  chatShadow.querySelector('.chat-wrapper');
        if (!messagesContainer) throw "‚è≥ Esperando contenedor de mensajes...";

        console.log("‚úÖ Contenedor de mensajes encontrado:", messagesContainer);

        setInterval(() => {
          console.log("üîç Buscando mensajes nuevos...");
          const allDivs = messagesContainer.querySelectorAll('div');
          allDivs.forEach(div => {
            const text = div.innerText;
            if (text && text.includes("Agent Says:") && text.includes("REDIRECT:") && !div.dataset.redirected) {
              div.dataset.redirected = "true"; // Evita redireccionar m√°s de una vez
              const url = text.split("REDIRECT:")[1].trim();
              console.log("‚û°Ô∏è Redirigiendo a:", url);
              window.location.href = url;
            }
          });
        }, 1000);

      } catch (e) {
        console.warn(e);
        setTimeout(waitForChat, 500);
      }
    };

    waitForChat();
  });
</script>
</body>
</html>
